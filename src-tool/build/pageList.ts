import * as fs from 'fs';
import {srcUrl} from '../util/url';
import {getPageList} from '../util/getPageList';

const {pageListByPublishedAt, toListByUpdatedAt} = await getPageList();
const code = `
// This file was generated by \`npm run build:pageList\`
/* eslint-disable */
import {JSON} from '../global';
export interface PageData {
    pathname: string,
    title: string,
    filePath: string,
    publishedAt: string,
    updatedAt: string,
    commitCount: number,
}
export const pageListByPublishedAt: Array<PageData> = JSON.parse(\`[
${pageListByPublishedAt.map((page) => JSON.stringify(page).replace(/`/g, '\\`')).join(',\n')}
]\`);
export const pageListByUpdatedAt: Array<PageData> = (JSON.parse(${JSON.stringify(JSON.stringify(toListByUpdatedAt))}) as Array<number>).map((index) => pageListByPublishedAt[index]);
`.trimStart();
const dest = new URL('util/pageList.ts', srcUrl);
await fs.promises.writeFile(dest, code);
